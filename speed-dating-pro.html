<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Dating Pro - Pełna Wersja</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        /* ========== RESET I PODSTAWY ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-sm: 8px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        /* ========== SYSTEM EKRANÓW ========== */
        .screen {
            display: none;
            min-height: 100vh;
            padding: 20px;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ========== EKRAN WYBORU TRYBU ========== */
        .mode-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .mode-header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .logo i {
            font-size: 40px;
            color: #ff6b6b;
        }

        .logo h1 {
            font-size: 32px;
            font-weight: 700;
        }

        .tagline {
            font-size: 18px;
            opacity: 0.9;
        }

        .mode-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .mode-card {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            cursor: pointer;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .mode-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--primary);
        }

        .mode-card h3 {
            font-size: 22px;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .mode-card p {
            color: var(--gray);
            margin-bottom: 25px;
            font-size: 15px;
        }

        /* ========== PRZYCISKI ========== */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            white-space: nowrap;
        }

        .btn-block {
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid white;
            color: white;
        }

        .btn-outline:hover {
            background: white;
            color: var(--primary);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* ========== FORMULARZ REJESTRACJI ========== */
        .login-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow-lg);
        }

        .form-stepper {
            margin-bottom: 30px;
        }

        .stepper-progress {
            display: flex;
            justify-content: space-between;
            position: relative;
        }

        .stepper-progress::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gray-light);
            transform: translateY(-50%);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            background: white;
            padding: 0 10px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-light);
            border-radius: 50%;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--gray);
        }

        .step.active .step-number {
            background: var(--primary);
            color: white;
        }

        .step-label {
            font-size: 14px;
            color: var(--gray);
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
        }

        .form-step h2 {
            margin-bottom: 25px;
            color: var(--dark);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group i {
            margin-right: 8px;
            color: var(--primary);
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-sm);
            font-size: 16px;
            transition: var(--transition);
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .options-container {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .option-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px;
            border: 2px solid var(--gray-light);
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .option-btn:hover {
            border-color: var(--primary);
        }

        .option-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 30px;
        }

        .error-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        .form-hint {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .summary-card {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: 20px;
            margin-bottom: 20px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        /* ========== PANEL UŻYTKOWNIKA ========== */
        .user-header {
            background: white;
            padding: 20px 30px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .user-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .dashboard-section {
            margin-bottom: 30px;
        }

        .section-header {
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header h2 {
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .stat-content h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }

        .timer-display {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            color: var(--primary);
            font-family: monospace;
        }

        .timer-label {
            text-align: center;
            color: var(--gray);
            margin-top: 10px;
        }

        .waiting-message, .finished-message {
            text-align: center;
            padding: 40px 20px;
        }

        .waiting-icon, .finished-icon {
            font-size: 60px;
            color: var(--warning);
            margin-bottom: 20px;
        }

        .finished-icon {
            color: var(--success);
        }

        /* ========== PANEL ADMINISTRATORA ========== */
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .admin-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title h1 {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-subtitle {
            opacity: 0.9;
        }

        .admin-stats {
            padding: 30px;
            background: var(--light);
        }

        .admin-controls {
            padding: 30px;
            border-bottom: 1px solid var(--gray-light);
        }

        .control-section {
            margin-bottom: 30px;
        }

        .control-section h3 {
            margin-bottom: 15px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .time-settings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            align-items: end;
        }

        .time-input label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--gray);
        }

        .admin-tabs {
            padding: 30px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            border-bottom: 2px solid var(--gray-light);
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 15px 25px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .participants-table, .ratings-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .participants-table th, .ratings-table th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--gray-light);
        }

        .participants-table td, .ratings-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
        }

        .participant-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .participant-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .participant-avatar.small {
            width: 30px;
            height: 30px;
            font-size: 12px;
        }

        .gender-badge, .status-badge, .rating-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .gender-badge.male {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .gender-badge.female {
            background: rgba(236, 72, 153, 0.1);
            color: #ec4899;
        }

        .gender-badge.other {
            background: rgba(139, 92, 246, 0.1);
            color: #8b5cf6;
        }

        .status-badge.success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .status-badge.warning {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .rating-badge.yes {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .rating-badge.no {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .interest-tag {
            display: inline-block;
            padding: 2px 6px;
            background: var(--gray-light);
            border-radius: 3px;
            font-size: 11px;
            margin-right: 5px;
        }

        .pairings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .pairing-card {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: 20px;
        }

        .pairing-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .pairing-participants {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .pairing-connector {
            color: var(--primary);
            font-size: 20px;
        }

        .break-section {
            margin-top: 30px;
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius-sm);
        }

        .break-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .break-user {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: white;
            border-radius: var(--radius-sm);
        }

        .export-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .export-card {
            background: var(--light);
            border-radius: var(--radius-sm);
            padding: 25px;
            text-align: center;
        }

        .export-icon {
            font-size: 40px;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .export-info {
            margin-top: 30px;
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius-sm);
            font-size: 14px;
            color: var(--gray);
        }

        /* ========== EKRAN OCENIANIA ========== */
        .rating-container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow-lg);
        }

        .rating-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .rating-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .rate-btn {
            padding: 30px;
            border: 2px solid var(--gray-light);
            background: white;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .rate-btn:hover {
            border-color: var(--primary);
        }

        .rate-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .rate-btn i {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .rate-btn span {
            display: block;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .rate-btn p {
            font-size: 14px;
            opacity: 0.8;
        }

        /* ========== RESPONSYWNOŚĆ ========== */
        @media (max-width: 768px) {
            .mode-options {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .rating-options {
                grid-template-columns: 1fr;
            }
            
            .admin-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .control-buttons {
                flex-direction: column;
            }
            
            .tab-buttons {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .pairings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .login-container {
                padding: 20px;
            }
            
            .user-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .options-container {
                flex-direction: column;
            }
            
            .option-btn {
                width: 100%;
            }
        }

        /* ========== NARZĘDZIA ========== */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            background: var(--gray-light);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            color: var(--gray);
        }

        .badge.success {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .empty-list, .empty-pairings, .empty-ratings {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-list i, .empty-pairings i, .empty-ratings i {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <!-- Ekran ładowania (ukryty) -->
    <div id="loading-screen" class="screen" style="display: none;">
        <div class="loading-container" style="min-height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column;">
            <div class="loading-spinner" style="font-size: 60px; margin-bottom: 20px; color: white; animation: spin 1s linear infinite;">
                <i class="fas fa-heart"></i>
            </div>
            <h2 style="color: white; margin-bottom: 10px;">Speed Dating Pro</h2>
            <p style="color: rgba(255,255,255,0.8);">Ładowanie aplikacji...</p>
        </div>
    </div>

    <!-- Ekran wyboru trybu -->
    <div id="mode-screen" class="screen">
        <div class="mode-container">
            <div class="mode-header">
                <div class="logo">
                    <i class="fas fa-heart"></i>
                    <h1>Speed Dating Pro</h1>
                </div>
                <p class="tagline">Znajdź swoją parę!</p>
            </div>

            <div class="mode-options">
                <div class="mode-card" id="participant-mode">
                    <div class="mode-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <h3>Uczestnik</h3>
                    <p>Dołącz do wydarzenia i poznaj nowych ludzi</p>
                    <button class="btn btn-primary btn-block mode-select-btn" data-mode="participant">
                        <i class="fas fa-user-plus"></i> Zarejestruj się
                    </button>
                </div>

                <div class="mode-card" id="admin-mode">
                    <div class="mode-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <h3>Organizator</h3>
                    <p>Zarządzaj wydarzeniem i uczestnikami</p>
                    <button class="btn btn-warning btn-block mode-select-btn" data-mode="admin">
                        <i class="fas fa-cogs"></i> Panel administratora
                    </button>
                </div>

                <div class="mode-card" id="demo-mode">
                    <div class="mode-icon">
                        <i class="fas fa-vial"></i>
                    </div>
                    <h3>Tryb Demo</h3>
                    <p>Przetestuj aplikację z przykładowymi danymi</p>
                    <button class="btn btn-outline btn-block mode-select-btn" data-mode="demo">
                        <i class="fas fa-play-circle"></i> Rozpocznij demo
                    </button>
                </div>
            </div>

            <div class="mode-footer" style="text-align: center; color: rgba(255,255,255,0.7); margin-top: 30px;">
                <p><i class="fas fa-info-circle"></i> Speed Dating Pro v2.0.0</p>
            </div>
        </div>
    </div>

    <!-- Ekran logowania/rejestracji -->
    <div id="login-screen" class="screen">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">
                    <i class="fas fa-heart"></i>
                    <h1>Speed Dating Pro</h1>
                </div>
                <p class="tagline">Znajdź swoją parę!</p>
            </div>

            <form id="register-form" class="register-form">
                <div class="form-stepper">
                    <div class="stepper-progress">
                        <div class="step active" data-step="1">
                            <span class="step-number">1</span>
                            <span class="step-label">Dane</span>
                        </div>
                        <div class="step" data-step="2">
                            <span class="step-number">2</span>
                            <span class="step-label">Preferencje</span>
                        </div>
                        <div class="step" data-step="3">
                            <span class="step-number">3</span>
                            <span class="step-label">Podsumowanie</span>
                        </div>
                    </div>
                </div>

                <!-- Krok 1: Podstawowe dane -->
                <div class="form-step active" data-step="1">
                    <h2>Podstawowe informacje</h2>
                    
                    <div class="form-group">
                        <label for="reg-username"><i class="fas fa-user"></i> Nazwa użytkownika *</label>
                        <input type="text" id="reg-username" placeholder="Wprowadź swój nick" required>
                        <div class="error-message" id="username-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-email"><i class="fas fa-envelope"></i> Adres email *</label>
                        <input type="email" id="reg-email" placeholder="twoj@email.com" required>
                        <div class="error-message" id="email-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-age"><i class="fas fa-birthday-cake"></i> Wiek (opcjonalnie)</label>
                        <input type="number" id="reg-age" placeholder="18" min="18" max="100">
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-venus-mars"></i> Twoja płeć *</label>
                        <div id="gender-selection" class="options-container">
                            <button type="button" class="option-btn gender-btn" data-value="male">
                                <i class="fas fa-mars"></i> Mężczyzna
                            </button>
                            <button type="button" class="option-btn gender-btn" data-value="female">
                                <i class="fas fa-venus"></i> Kobieta
                            </button>
                            <button type="button" class="option-btn gender-btn" data-value="other">
                                <i class="fas fa-neuter"></i> Inna
                            </button>
                        </div>
                        <input type="hidden" id="reg-gender" name="gender">
                        <div class="error-message" id="gender-error"></div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" id="back-to-mode">
                            <i class="fas fa-arrow-left"></i> Wstecz
                        </button>
                        <button type="button" class="btn btn-primary btn-next" data-next="2">
                            Dalej <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Krok 2: Preferencje -->
                <div class="form-step" data-step="2">
                    <h2>Twoje preferencje</h2>
                    
                    <div class="form-group">
                        <label><i class="fas fa-heart"></i> Szukam (możesz wybrać kilka) *</label>
                        <div id="interests-selection" class="options-container">
                            <button type="button" class="option-btn interest-btn multi" data-value="male">
                                <i class="fas fa-mars"></i> Mężczyzn
                            </button>
                            <button type="button" class="option-btn interest-btn multi" data-value="female">
                                <i class="fas fa-venus"></i> Kobiet
                            </button>
                            <button type="button" class="option-btn interest-btn multi" data-value="other">
                                <i class="fas fa-neuter"></i> Innych
                            </button>
                        </div>
                        <input type="hidden" id="reg-interests" name="interests" value="[]">
                        <div class="error-message" id="interests-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reg-bio"><i class="fas fa-comment-alt"></i> Opis siebie (opcjonalnie)</label>
                        <textarea id="reg-bio" placeholder="Napisz coś o sobie..." rows="4" maxlength="200"></textarea>
                        <div class="form-hint">
                            <span id="bio-counter">0</span>/200 znaków
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline btn-back-step" data-prev="1">
                            <i class="fas fa-arrow-left"></i> Wstecz
                        </button>
                        <button type="button" class="btn btn-primary btn-next" data-next="3">
                            Dalej <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Krok 3: Podsumowanie -->
                <div class="form-step" data-step="3">
                    <h2>Podsumowanie</h2>
                    
                    <div class="summary-card">
                        <h3>Twoje dane:</h3>
                        <div class="summary-item">
                            <span class="summary-label">Nazwa użytkownika:</span>
                            <span class="summary-value" id="summary-username">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Email:</span>
                            <span class="summary-value" id="summary-email">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Płeć:</span>
                            <span class="summary-value" id="summary-gender">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Wiek:</span>
                            <span class="summary-value" id="summary-age">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Szukam:</span>
                            <span class="summary-value" id="summary-interests">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">O sobie:</span>
                            <span class="summary-value" id="summary-bio">-</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="reg-terms" required>
                            <span>Akceptuję regulamin wydarzenia *</span>
                        </label>
                        <div class="error-message" id="terms-error"></div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline btn-back-step" data-prev="2">
                            <i class="fas fa-arrow-left"></i> Wstecz
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-user-plus"></i> Zarejestruj się i dołącz
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Panel użytkownika -->
    <div id="user-panel" class="screen">
        <div class="user-header">
            <div class="user-info">
                <h1><i class="fas fa-user"></i> <span id="user-name">Użytkownik</span></h1>
                <p>Panel uczestnika</p>
            </div>
            <button id="user-logout" class="btn btn-logout">
                <i class="fas fa-sign-out-alt"></i> Wyloguj
            </button>
        </div>
        
        <div id="user-content" class="user-content">
            <!-- Zawartość ładowana dynamicznie -->
        </div>
    </div>

    <!-- Ekran oceniania -->
    <div id="rating-screen" class="screen">
        <div class="rating-container">
            <div class="rating-header">
                <h2><i class="fas fa-star"></i> Oceń rozmówcę</h2>
                <p>Jak oceniasz rozmowę z <span id="rate-person">...</span>?</p>
            </div>
            
            <div class="rating-options">
                <button class="rate-btn" data-rating="yes">
                    <i class="fas fa-thumbs-up"></i>
                    <span>TAK</span>
                    <p>Chcę się jeszcze spotkać</p>
                </button>
                <button class="rate-btn" data-rating="no">
                    <i class="fas fa-thumbs-down"></i>
                    <span>NIE</span>
                    <p>Nie jestem zainteresowany/a</p>
                </button>
            </div>
            
            <div class="form-group">
                <label for="rating-note"><i class="fas fa-comment"></i> Dodatkowe uwagi (opcjonalnie)</label>
                <textarea id="rating-note" placeholder="Co Ci się podobało? Co mogłoby być lepiej?" rows="4"></textarea>
            </div>
            
            <div class="rating-actions">
                <button id="submit-rating" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Wyślij ocenę
                </button>
            </div>
        </div>
    </div>

    <!-- Panel administratora -->
    <div id="admin-panel" class="screen">
        <!-- Zawartość ładowana dynamicznie -->
    </div>

    <!-- Skrypty -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        // ============================================
        // SPEED DATING PRO - PEŁNA WERSJA W JEDNYM PLIKU
        // ============================================

        // ========== KONFIGURACJA ==========
        const CONFIG = {
            MAX_PARTICIPANTS: 50,
            MIN_PARTICIPANTS: 2,
            MAX_ROUNDS: 10,
            MIN_ROUND_TIME: 1,
            MAX_ROUND_TIME: 30,
            SESSION_TIMEOUT: 30 * 60 * 1000,
            HEARTBEAT_INTERVAL: 30000,
            VERSION: '2.0.0'
        };

        // ========== GLOBALNE ZMIENNE ==========
        let participants = [];
        let eventData = {};
        let currentUser = null;
        let timerInterval = null;
        let currentPartner = null;
        let isDemoMode = false;

        // ========== KLASA APLIKACJI ==========
        class SpeedDatingApp {
            constructor() {
                console.log(`Speed Dating Pro v${CONFIG.VERSION}`);
                this.initialize();
            }

            initialize() {
                // Inicjalizacja toastr
                toastr.options = {
                    positionClass: 'toast-top-right',
                    progressBar: true,
                    timeOut: 3000,
                    closeButton: true
                };

                this.loadData();
                this.setupEventListeners();
                this.startHeartbeat();
                
                // Pokaż ekran wyboru trybu
                setTimeout(() => {
                    this.detectRole();
                }, 100);
            }

            hideAllScreens() {
                document.querySelectorAll('.screen').forEach(screen => {
                    screen.classList.remove('active');
                });
            }

            // ========== SYSTEM DANYCH ==========
            loadData() {
                try {
                    const storedParticipants = localStorage.getItem('speedDatingParticipants');
                    participants = storedParticipants ? JSON.parse(storedParticipants) : [];
                    
                    const storedEvent = localStorage.getItem('speedDatingEvent');
                    eventData = storedEvent ? JSON.parse(storedEvent) : this.getDefaultEventData();
                    
                    this.cleanOldSessions();
                    console.log(`Załadowano ${participants.length} uczestników`);
                } catch (error) {
                    console.error('Błąd ładowania danych:', error);
                    participants = [];
                    eventData = this.getDefaultEventData();
                }
            }

            getDefaultEventData() {
                return {
                    status: 'waiting',
                    currentRound: 1,
                    totalRounds: 5,
                    roundTime: 5,
                    ratingTime: 2,
                    pairings: [],
                    ratings: [],
                    settings: {
                        allowRepeats: false,
                        maxParticipants: CONFIG.MAX_PARTICIPANTS,
                        matchingAlgorithm: 'smart',
                        notifications: true
                    },
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
            }

            saveData() {
                try {
                    eventData.updatedAt = new Date().toISOString();
                    localStorage.setItem('speedDatingParticipants', JSON.stringify(participants));
                    localStorage.setItem('speedDatingEvent', JSON.stringify(eventData));
                } catch (error) {
                    console.error('Błąd zapisywania danych:', error);
                    this.showNotification('Błąd zapisywania danych!', 'error');
                }
            }

            cleanOldSessions() {
                const now = Date.now();
                participants = participants.filter(p => {
                    if (!p || !p.lastSeen) return false;
                    const lastSeen = new Date(p.lastSeen).getTime();
                    return (now - lastSeen) < CONFIG.SESSION_TIMEOUT;
                });
                this.saveData();
            }

            // ========== DETEKCJA ROLI ==========
            detectRole() {
                try {
                    this.hideAllScreens();
                    
                    // Sprawdź URL parametry
                    const urlParams = new URLSearchParams(window.location.search);
                    const mode = urlParams.get('mode');
                    
                    if (mode === 'admin') {
                        this.showAdminPanel();
                        return;
                    }
                    
                    // Sprawdź sesję użytkownika
                    const sessionId = localStorage.getItem('currentSessionId');
                    if (sessionId) {
                        currentUser = participants.find(p => p && p.sessionId === sessionId && p.active !== false);
                        
                        if (currentUser) {
                            this.updateUserLastSeen();
                            this.showUserPanel();
                            return;
                        }
                    }
                    
                    // Domyślnie pokaż wybór trybu
                    this.showModeSelection();
                    
                } catch (error) {
                    console.error('Błąd detectRole:', error);
                    this.showModeSelection();
                }
            }

            showModeSelection() {
                this.hideAllScreens();
                document.getElementById('mode-screen').classList.add('active');
            }

            // ========== REJESTRACJA ==========
            showRegistrationScreen() {
                this.hideAllScreens();
                document.getElementById('login-screen').classList.add('active');
                this.initializeRegistrationForm();
            }

            initializeRegistrationForm() {
                const form = document.getElementById('register-form');
                if (!form) return;

                // Inicjalizacja przycisków płci
                document.querySelectorAll('.gender-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.gender-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        const genderInput = document.getElementById('reg-gender');
                        if (genderInput) genderInput.value = btn.dataset.value;
                        this.clearError('gender-error');
                    });
                });

                // Inicjalizacja przycisków zainteresowań
                document.querySelectorAll('.interest-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        btn.classList.toggle('selected');
                        this.updateInterests();
                    });
                });

                // Przyciski nawigacji
                document.querySelectorAll('.btn-next').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const nextStep = parseInt(btn.dataset.next);
                        if (this.validateStep(nextStep - 1)) {
                            this.showStep(nextStep);
                        }
                    });
                });

                document.querySelectorAll('.btn-back-step').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const prevStep = parseInt(btn.dataset.prev);
                        this.showStep(prevStep);
                    });
                });

                // Przycisk powrotu
                const backBtn = document.getElementById('back-to-mode');
                if (backBtn) {
                    backBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showModeSelection();
                    });
                }

                // Obsługa formularza
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    if (this.validateStep(3)) {
                        this.handleRegistration();
                    }
                });

                this.showStep(1);
            }

            showStep(stepNumber) {
                const steps = document.querySelectorAll('.form-step');
                const stepperSteps = document.querySelectorAll('.stepper-progress .step');
                
                steps.forEach(step => step.classList.remove('active'));
                stepperSteps.forEach(step => step.classList.remove('active'));
                
                const currentStep = document.querySelector(`.form-step[data-step="${stepNumber}"]`);
                const currentStepperStep = document.querySelector(`.step[data-step="${stepNumber}"]`);
                
                if (currentStep) currentStep.classList.add('active');
                if (currentStepperStep) currentStepperStep.classList.add('active');
                
                if (stepNumber === 3) {
                    this.updateSummary();
                }
            }

            validateStep(step) {
                switch(step) {
                    case 1: return this.validateStep1();
                    case 2: return this.validateStep2();
                    case 3: return this.validateStep3();
                    default: return true;
                }
            }

            validateStep1() {
                let valid = true;
                if (!this.validateUsername()) valid = false;
                if (!this.validateEmail()) valid = false;
                if (!this.validateGender()) valid = false;
                return valid;
            }

            validateStep2() {
                return this.validateInterests();
            }

            validateStep3() {
                const termsCheckbox = document.getElementById('reg-terms');
                if (termsCheckbox && !termsCheckbox.checked) {
                    this.showError('terms-error', 'Musisz zaakceptować regulamin');
                    return false;
                }
                this.clearError('terms-error');
                return true;
            }

            validateUsername() {
                const usernameInput = document.getElementById('reg-username');
                if (!usernameInput) return false;
                
                const username = usernameInput.value.trim();
                
                if (!username) {
                    this.showError('username-error', 'Nazwa użytkownika jest wymagana');
                    return false;
                }
                
                if (username.length < 3 || username.length > 20) {
                    this.showError('username-error', 'Nazwa musi mieć 3-20 znaków');
                    return false;
                }
                
                const existingUser = participants.find(p => 
                    p && p.username.toLowerCase() === username.toLowerCase() && p.active !== false
                );
                
                if (existingUser) {
                    this.showError('username-error', 'Nazwa użytkownika jest już zajęta');
                    return false;
                }
                
                this.clearError('username-error');
                return true;
            }

            validateEmail() {
                const emailInput = document.getElementById('reg-email');
                if (!emailInput) return false;
                
                const email = emailInput.value.trim();
                
                if (!email) {
                    this.showError('email-error', 'Email jest wymagany');
                    return false;
                }
                
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.showError('email-error', 'Podaj poprawny adres email');
                    return false;
                }
                
                this.clearError('email-error');
                return true;
            }

            validateGender() {
                const genderInput = document.getElementById('reg-gender');
                if (!genderInput) return false;
                
                if (!genderInput.value) {
                    this.showError('gender-error', 'Wybierz swoją płeć');
                    return false;
                }
                
                this.clearError('gender-error');
                return true;
            }

            validateInterests() {
                const interestsInput = document.getElementById('reg-interests');
                if (!interestsInput) return false;
                
                const interests = JSON.parse(interestsInput.value || '[]');
                
                if (interests.length === 0) {
                    this.showError('interests-error', 'Wybierz przynajmniej jedną opcję');
                    return false;
                }
                
                this.clearError('interests-error');
                return true;
            }

            showError(elementId, message) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = message;
                    element.style.display = 'block';
                }
            }

            clearError(elementId) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = '';
                    element.style.display = 'none';
                }
            }

            updateInterests() {
                const selected = Array.from(document.querySelectorAll('.interest-btn.selected'))
                    .map(btn => btn.dataset.value);
                const interestsInput = document.getElementById('reg-interests');
                if (interestsInput) {
                    interestsInput.value = JSON.stringify(selected);
                }
            }

            updateSummary() {
                const username = document.getElementById('reg-username')?.value || '-';
                const email = document.getElementById('reg-email')?.value || '-';
                const gender = document.getElementById('reg-gender')?.value;
                const age = document.getElementById('reg-age')?.value;
                const interests = document.getElementById('reg-interests')?.value || '[]';
                const bio = document.getElementById('reg-bio')?.value;
                
                document.getElementById('summary-username').textContent = username;
                document.getElementById('summary-email').textContent = email;
                
                const genderText = gender === 'male' ? 'Mężczyzna' : 
                                  gender === 'female' ? 'Kobieta' : 'Inna';
                document.getElementById('summary-gender').textContent = genderText;
                
                document.getElementById('summary-age').textContent = age || 'Nie podano';
                
                const interestsArray = JSON.parse(interests);
                const interestsText = interestsArray.map(i => 
                    i === 'male' ? 'Mężczyzn' : 
                    i === 'female' ? 'Kobiet' : 'Innych'
                ).join(', ');
                document.getElementById('summary-interests').textContent = interestsText || '-';
                
                document.getElementById('summary-bio').textContent = bio || 'Nie podano';
            }

            async handleRegistration() {
                try {
                    const activeParticipants = participants.filter(p => p && p.active !== false);
                    if (activeParticipants.length >= CONFIG.MAX_PARTICIPANTS) {
                        this.showNotification('Osiągnięto limit uczestników!', 'error');
                        return;
                    }

                    const userData = {
                        id: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        username: document.getElementById('reg-username').value.trim(),
                        email: document.getElementById('reg-email').value.trim(),
                        gender: document.getElementById('reg-gender').value,
                        interested: JSON.parse(document.getElementById('reg-interests').value || '[]'),
                        age: document.getElementById('reg-age')?.value || null,
                        bio: document.getElementById('reg-bio')?.value || '',
                        joinedAt: new Date().toISOString(),
                        ratings: {},
                        tags: {},
                        status: 'active',
                        active: true,
                        lastSeen: new Date().toISOString(),
                        sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        avatarColor: this.getRandomColor()
                    };

                    participants.push(userData);
                    currentUser = userData;
                    this.saveData();

                    localStorage.setItem('currentSessionId', userData.sessionId);
                    
                    this.showNotification('Rejestracja zakończona sukcesem!', 'success');
                    this.showUserPanel();

                } catch (error) {
                    console.error('Błąd rejestracji:', error);
                    this.showNotification('Błąd rejestracji!', 'error');
                }
            }

            getRandomColor() {
                const colors = ['#667eea', '#764ba2', '#f56565', '#ed8936', '#ecc94b', '#48bb78', '#38b2ac', '#4299e1'];
                return colors[Math.floor(Math.random() * colors.length)];
            }

            // ========== PANEL UŻYTKOWNIKA ==========
            showUserPanel() {
                this.hideAllScreens();
                document.getElementById('user-panel').classList.add('active');
                
                if (!currentUser) {
                    this.showRegistrationScreen();
                    return;
                }

                this.updateUserInterface();
            }

            updateUserInterface() {
                const userNameElement = document.getElementById('user-name');
                if (userNameElement) userNameElement.textContent = currentUser.username;
                
                const logoutBtn = document.getElementById('user-logout');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => {
                        this.handleLogout();
                    });
                }
                
                this.renderDashboard();
            }

            renderDashboard() {
                const content = document.getElementById('user-content');
                if (!content) return;

                let html = `
                    <div class="dashboard-section">
                        <div class="section-header">
                            <h2><i class="fas fa-home"></i> Panel główny</h2>
                            <div class="user-welcome">
                                <p>Witaj, <strong>${currentUser.username}</strong>! 👋</p>
                                <p style="font-size: 14px; color: #666; margin-top: 5px;">Status wydarzenia: <strong>${eventData.status === 'active' ? 'Aktywne' : 'Oczekuje'}</strong></p>
                            </div>
                        </div>
                        
                        <div class="dashboard-stats">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3>Aktualna runda</h3>
                                        <div class="stat-value">${eventData.currentRound || 1}/${eventData.totalRounds || 5}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                                        <i class="fas fa-handshake"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3>Rozmowy</h3>
                                        <div class="stat-value">${Object.keys(currentUser.ratings || {}).length}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                                        <i class="fas fa-heart"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3>Dopasowania</h3>
                                        <div class="stat-value">${this.calculateMatches().length}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div class="stat-content">
                                        <h3>Czas rundy</h3>
                                        <div class="stat-value">${eventData.roundTime || 5} min</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                if (eventData.status === 'active') {
                    html += `
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-info-circle"></i> Informacje</h2>
                            </div>
                            <div class="info-box">
                                <p><i class="fas fa-users"></i> Uczestników: <strong>${participants.filter(p => p && p.active !== false).length}</strong></p>
                                <p><i class="fas fa-clock"></i> Czas do końca rundy: <strong>${this.formatTime((eventData.roundTime || 5) * 60)}</strong></p>
                                ${eventData.pairings && eventData.pairings[eventData.currentRound - 1] ? 
                                    `<p><i class="fas fa-chair"></i> Aktywnych par: <strong>${eventData.pairings[eventData.currentRound - 1].pairs?.length || 0}</strong></p>` : 
                                    ''}
                            </div>
                        </div>
                    `;
                } else if (eventData.status === 'waiting') {
                    html += `
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-hourglass-half"></i> Oczekiwanie na rozpoczęcie</h2>
                            </div>
                            <div class="waiting-message">
                                <div class="waiting-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <h3>Wydarzenie jeszcze się nie rozpoczęło</h3>
                                <p>Organizator poinformuje Cię, kiedy będziesz mógł dołączyć do rozmów.</p>
                                <div class="waiting-info">
                                    <p><i class="fas fa-user-friends"></i> Zarejestrowani uczestnicy: <strong>${participants.filter(p => p && p.active !== false).length}</strong></p>
                                    <p><i class="fas fa-bullhorn"></i> Organizator może rozpocząć wydarzenie gdy będzie co najmniej ${CONFIG.MIN_PARTICIPANTS} uczestników</p>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-flag-checkered"></i> Wydarzenie zakończone</h2>
                            </div>
                            <div class="finished-message">
                                <div class="finished-icon">
                                    <i class="fas fa-trophy"></i>
                                </div>
                                <h3>Dziękujemy za udział!</h3>
                                <p>Twoje wyniki zostały zapisane.</p>
                                <div class="final-stats">
                                    <p><i class="fas fa-calendar-alt"></i> Rozegrane rundy: <strong>${eventData.currentRound || 0}</strong></p>
                                    <p><i class="fas fa-star"></i> Twoje oceny: <strong>${Object.keys(currentUser.ratings || {}).length}</strong></p>
                                    <p><i class="fas fa-heart"></i> Dopasowania: <strong>${this.calculateMatches().length}</strong></p>
                                </div>
                            </div>
                        </div>
                    `;
                }

                content.innerHTML = html;
            }

            calculateMatches() {
                if (!currentUser || !currentUser.ratings) return [];
                
                const matches = [];
                const userRatings = currentUser.ratings;
                
                for (const [ratedUserId, rating] of Object.entries(userRatings)) {
                    const ratedUser = participants.find(p => p && p.id === ratedUserId);
                    if (!ratedUser || !ratedUser.ratings) continue;
                    
                    const theirRating = ratedUser.ratings[currentUser.id];
                    if (theirRating && theirRating.rating === 'yes' && rating.rating === 'yes') {
                        matches.push({
                            partnerId: ratedUserId,
                            partnerName: ratedUser.username,
                            score: 100,
                            mutual: true,
                            timestamp: rating.timestamp
                        });
                    }
                }
                
                return matches;
            }

            // ========== PANEL ADMINISTRATORA ==========
            showAdminPanel() {
                this.hideAllScreens();
                document.getElementById('admin-panel').classList.add('active');
                this.renderAdminPanel();
            }

            renderAdminPanel() {
                const adminPanel = document.getElementById('admin-panel');
                if (!adminPanel) return;

                const activeParticipants = participants.filter(p => p && p.active !== false);
                
                adminPanel.innerHTML = `
                    <div class="admin-container">
                        <div class="admin-content">
                            <div class="admin-header">
                                <div class="admin-title">
                                    <h1><i class="fas fa-crown"></i> Panel Administratora</h1>
                                    <p class="admin-subtitle">Zarządzanie wydarzeniem Speed Dating Pro</p>
                                </div>
                                <div class="admin-actions">
                                    <button class="btn btn-primary" id="refresh-admin">
                                        <i class="fas fa-redo"></i> Odśwież
                                    </button>
                                    <button class="btn btn-outline" id="back-to-mode-admin">
                                        <i class="fas fa-home"></i> Strona główna
                                    </button>
                                </div>
                            </div>
                            
                            <div class="admin-stats">
                                <div class="stats-grid">
                                    <div class="stat-card">
                                        <div class="stat-icon admin" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="stat-content">
                                            <h3>Uczestnicy</h3>
                                            <div class="stat-value">${activeParticipants.length}</div>
                                            <div class="stat-subtitle">z ${CONFIG.MAX_PARTICIPANTS}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-card">
                                        <div class="stat-icon success" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                                            <i class="fas fa-play-circle"></i>
                                        </div>
                                        <div class="stat-content">
                                            <h3>Status</h3>
                                            <div class="stat-value">${eventData.status === 'active' ? 'Aktywne' : 'Oczekuje'}</div>
                                            <div class="stat-subtitle">${eventData.status === 'active' ? 'Runda ' + eventData.currentRound : 'Gotowe do startu'}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-card">
                                        <div class="stat-icon warning" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="stat-content">
                                            <h3>Czas rundy</h3>
                                            <div class="stat-value">${eventData.roundTime || 5} min</div>
                                            <div class="stat-subtitle">Ocena: ${eventData.ratingTime || 2} min</div>
                                        </div>
                                    </div>
                                    
                                    <div class="stat-card">
                                        <div class="stat-icon info" style="background: rgba(59, 130, 246, 0.1); color: #3b82f6;">
                                            <i class="fas fa-star"></i>
                                        </div>
                                        <div class="stat-content">
                                            <h3>Oceny</h3>
                                            <div class="stat-value">${eventData.ratings?.length || 0}</div>
                                            <div class="stat-subtitle">wysłanych ocen</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-controls">
                                <div class="control-section">
                                    <h3><i class="fas fa-cogs"></i> Sterowanie wydarzeniem</h3>
                                    <div class="control-buttons">
                                        <button class="btn btn-success" id="start-event-btn" ${eventData.status === 'active' ? 'disabled' : ''}>
                                            <i class="fas fa-play"></i> Rozpocznij wydarzenie
                                        </button>
                                        <button class="btn btn-warning" id="next-round-btn" ${eventData.status !== 'active' ? 'disabled' : ''}>
                                            <i class="fas fa-forward"></i> Następna runda
                                        </button>
                                        <button class="btn btn-danger" id="end-event-btn">
                                            <i class="fas fa-stop"></i> Zakończ wydarzenie
                                        </button>
                                        <button class="btn btn-primary" id="generate-pairs-btn">
                                            <i class="fas fa-random"></i> Generuj pary
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="control-section">
                                    <h3><i class="fas fa-clock"></i> Ustawienia czasu</h3>
                                    <div class="time-settings">
                                        <div class="time-input">
                                            <label><i class="fas fa-hourglass"></i> Czas rundy (min)</label>
                                            <input type="number" id="round-time" value="${eventData.roundTime || 5}" min="1" max="30">
                                        </div>
                                        <div class="time-input">
                                            <label><i class="fas fa-star"></i> Czas oceny (min)</label>
                                            <input type="number" id="rating-time" value="${eventData.ratingTime || 2}" min="1" max="10">
                                        </div>
                                        <div class="time-input">
                                            <label><i class="fas fa-flag-checkered"></i> Liczba rund</label>
                                            <input type="number" id="total-rounds" value="${eventData.totalRounds || 5}" min="1" max="10">
                                        </div>
                                        <button class="btn btn-primary" id="save-time-btn">
                                            <i class="fas fa-save"></i> Zapisz ustawienia
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-tabs">
                                <div class="tab-buttons">
                                    <button class="tab-btn active" data-tab="participants">
                                        <i class="fas fa-users"></i> Uczestnicy
                                    </button>
                                    <button class="tab-btn" data-tab="pairings">
                                        <i class="fas fa-chair"></i> Stoliki
                                    </button>
                                    <button class="tab-btn" data-tab="ratings">
                                        <i class="fas fa-star"></i> Oceny
                                    </button>
                                    <button class="tab-btn" data-tab="export">
                                        <i class="fas fa-download"></i> Eksport
                                    </button>
                                </div>
                                
                                <div class="tab-content">
                                    <div class="tab-pane active" id="participants-tab">
                                        <div class="participants-list">
                                            <div class="section-header">
                                                <h3><i class="fas fa-users"></i> Lista uczestników</h3>
                                                <span class="badge">${activeParticipants.length} osób</span>
                                            </div>
                                            ${activeParticipants.length === 0 ? `
                                                <div class="empty-list">
                                                    <i class="fas fa-users-slash"></i>
                                                    <p>Brak uczestników</p>
                                                    <p class="empty-subtitle">Zachęć uczestników do rejestracji!</p>
                                                </div>
                                            ` : `
                                                <div class="table-container">
                                                    <table class="participants-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Nazwa</th>
                                                                <th>Email</th>
                                                                <th>Płeć</th>
                                                                <th>Szuka</th>
                                                                <th>Status</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${activeParticipants.map(p => `
                                                                <tr>
                                                                    <td>
                                                                        <div class="participant-info">
                                                                            <div class="participant-avatar small" style="background: ${p.avatarColor || '#667eea'}">
                                                                                <i class="fas fa-user"></i>
                                                                            </div>
                                                                            <div>
                                                                                <strong>${p.username}</strong>
                                                                                ${p.age ? `<div class="participant-age">${p.age} lat</div>` : ''}
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                    <td>${p.email}</td>
                                                                    <td>
                                                                        <span class="gender-badge ${p.gender}">
                                                                            <i class="fas fa-${p.gender === 'male' ? 'mars' : p.gender === 'female' ? 'venus' : 'neuter'}"></i>
                                                                            ${p.gender === 'male' ? 'M' : p.gender === 'female' ? 'K' : 'I'}
                                                                        </span>
                                                                    </td>
                                                                    <td>
                                                                        ${p.interested?.map(i => 
                                                                            `<span class="interest-tag ${i}">
                                                                                <i class="fas fa-${i === 'male' ? 'mars' : i === 'female' ? 'venus' : 'neuter'}"></i>
                                                                                ${i === 'male' ? 'M' : i === 'female' ? 'K' : 'I'}
                                                                            </span>`
                                                                        ).join('') || '-'}
                                                                    </td>
                                                                    <td>
                                                                        <span class="status-badge success">
                                                                            <i class="fas fa-check-circle"></i> Aktywny
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            `).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane" id="pairings-tab">
                                        <div class="pairings-container">
                                            <div class="section-header">
                                                <h3><i class="fas fa-chair"></i> Stoliki - Runda ${eventData.currentRound || 1}</h3>
                                                <div class="header-actions">
                                                    <button class="btn btn-sm btn-primary" id="refresh-pairings">
                                                        <i class="fas fa-sync"></i> Odśwież
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            ${eventData.pairings && eventData.pairings[eventData.currentRound - 1] && eventData.pairings[eventData.currentRound - 1].pairs?.length > 0 ? `
                                                <div class="pairings-stats">
                                                    <div class="stat-item">
                                                        <i class="fas fa-chair"></i>
                                                        <span>Stolików: <strong>${eventData.pairings[eventData.currentRound - 1].pairs.length}</strong></span>
                                                    </div>
                                                    <div class="stat-item">
                                                        <i class="fas fa-users"></i>
                                                        <span>Osób w parach: <strong>${eventData.pairings[eventData.currentRound - 1].pairs.length * 2}</strong></span>
                                                    </div>
                                                    <div class="stat-item">
                                                        <i class="fas fa-coffee"></i>
                                                        <span>Na przerwie: <strong>${eventData.pairings[eventData.currentRound - 1].breakTable?.length || 0}</strong></span>
                                                    </div>
                                                </div>
                                                
                                                <div class="pairings-grid">
                                                    ${eventData.pairings[eventData.currentRound - 1].pairs.map((pair, index) => {
                                                        const [user1, user2] = pair;
                                                        return `
                                                            <div class="pairing-card">
                                                                <div class="pairing-header">
                                                                    <h4><i class="fas fa-chair"></i> Stolik ${index + 1}</h4>
                                                                    <span class="pairing-round">Runda ${eventData.currentRound}</span>
                                                                </div>
                                                                <div class="pairing-participants">
                                                                    <div class="participant">
                                                                        <div class="participant-avatar" style="background: ${user1.avatarColor || '#667eea'}">
                                                                            <i class="fas fa-user"></i>
                                                                        </div>
                                                                        <div class="participant-info">
                                                                            <strong>${user1.username}</strong>
                                                                            <div class="participant-details">
                                                                                <span class="gender">
                                                                                    <i class="fas fa-${user1.gender === 'male' ? 'mars' : user1.gender === 'female' ? 'venus' : 'neuter'}"></i>
                                                                                    ${user1.gender === 'male' ? 'Mężczyzna' : user1.gender === 'female' ? 'Kobieta' : 'Inna'}
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="pairing-connector">
                                                                        <i class="fas fa-heart"></i>
                                                                    </div>
                                                                    <div class="participant">
                                                                        <div class="participant-avatar" style="background: ${user2.avatarColor || '#ff6b6b'}">
                                                                            <i class="fas fa-user"></i>
                                                                        </div>
                                                                        <div class="participant-info">
                                                                            <strong>${user2.username}</strong>
                                                                            <div class="participant-details">
                                                                                <span class="gender">
                                                                                    <i class="fas fa-${user2.gender === 'male' ? 'mars' : user2.gender === 'female' ? 'venus' : 'neuter'}"></i>
                                                                                    ${user2.gender === 'male' ? 'Mężczyzna' : user2.gender === 'female' ? 'Kobieta' : 'Inna'}
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        `;
                                                    }).join('')}
                                                </div>
                                                
                                                ${eventData.pairings[eventData.currentRound - 1].breakTable?.length > 0 ? `
                                                    <div class="break-section">
                                                        <h4><i class="fas fa-coffee"></i> Osoby na przerwie (${eventData.pairings[eventData.currentRound - 1].breakTable.length})</h4>
                                                        <div class="break-list">
                                                            ${eventData.pairings[eventData.currentRound - 1].breakTable.map(user => `
                                                                <div class="break-user">
                                                                    <div class="break-user-avatar" style="background: ${user.avatarColor || '#94a3b8'}">
                                                                        <i class="fas fa-user"></i>
                                                                    </div>
                                                                    <span>${user.username}</span>
                                                                </div>
                                                            `).join('')}
                                                        </div>
                                                    </div>
                                                ` : ''}
                                            ` : `
                                                <div class="empty-pairings">
                                                    <i class="fas fa-random"></i>
                                                    <h4>Brak wygenerowanych par</h4>
                                                    <p>Kliknij "Generuj pary" aby utworzyć pary dla uczestników</p>
                                                    <button class="btn btn-primary" id="generate-pairs-now">
                                                        <i class="fas fa-random"></i> Generuj pary
                                                    </button>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane" id="ratings-tab">
                                        <div class="ratings-container">
                                            <div class="section-header">
                                                <h3><i class="fas fa-star"></i> Wszystkie oceny</h3>
                                                <span class="badge">${eventData.ratings?.length || 0} ocen</span>
                                            </div>
                                            
                                            ${eventData.ratings?.length > 0 ? `
                                                <div class="ratings-stats">
                                                    <div class="stat-badge success">
                                                        <i class="fas fa-thumbs-up"></i>
                                                        <span>TAK: ${eventData.ratings.filter(r => r.rating === 'yes').length}</span>
                                                    </div>
                                                    <div class="stat-badge danger">
                                                        <i class="fas fa-thumbs-down"></i>
                                                        <span>NIE: ${eventData.ratings.filter(r => r.rating === 'no').length}</span>
                                                    </div>
                                                    <div class="stat-badge warning">
                                                        <i class="fas fa-percentage"></i>
                                                        <span>Pozytywnych: ${Math.round((eventData.ratings.filter(r => r.rating === 'yes').length / eventData.ratings.length) * 100)}%</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="table-container">
                                                    <table class="ratings-table">
                                                        <thead>
                                                            <tr>
                                                                <th>Od</th>
                                                                <th>Do</th>
                                                                <th>Ocena</th>
                                                                <th>Runda</th>
                                                                <th>Czas</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            ${eventData.ratings.slice(-20).reverse().map(rating => {
                                                                const fromUser = participants.find(p => p && p.id === rating.from);
                                                                const toUser = participants.find(p => p && p.id === rating.to);
                                                                const ratingDate = new Date(rating.timestamp);
                                                                
                                                                return `
                                                                    <tr>
                                                                        <td>
                                                                            <div class="user-cell">
                                                                                <div class="user-avatar small" style="background: ${fromUser?.avatarColor || '#667eea'}">
                                                                                    <i class="fas fa-user"></i>
                                                                                </div>
                                                                                ${fromUser?.username || 'Nieznany'}
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <div class="user-cell">
                                                                                <div class="user-avatar small" style="background: ${toUser?.avatarColor || '#ff6b6b'}">
                                                                                    <i class="fas fa-user"></i>
                                                                                </div>
                                                                                ${toUser?.username || 'Nieznany'}
                                                                            </div>
                                                                        </td>
                                                                        <td>
                                                                            <span class="rating-badge ${rating.rating}">
                                                                                <i class="fas fa-${rating.rating === 'yes' ? 'thumbs-up' : 'thumbs-down'}"></i>
                                                                                ${rating.rating === 'yes' ? 'TAK' : 'NIE'}
                                                                            </span>
                                                                        </td>
                                                                        <td>${rating.round}</td>
                                                                        <td>${ratingDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>
                                                                    </tr>
                                                                `;
                                                            }).join('')}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            ` : `
                                                <div class="empty-ratings">
                                                    <i class="fas fa-star"></i>
                                                    <h4>Brak ocen</h4>
                                                    <p>Uczestnicy jeszcze nie oceniali rozmówców</p>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                    
                                    <div class="tab-pane" id="export-tab">
                                        <div class="export-container">
                                            <div class="section-header">
                                                <h3><i class="fas fa-download"></i> Eksport danych</h3>
                                            </div>
                                            
                                            <div class="export-cards">
                                                <div class="export-card">
                                                    <div class="export-icon">
                                                        <i class="fas fa-file-code"></i>
                                                    </div>
                                                    <h4>Eksport JSON</h4>
                                                    <p>Pełne dane w formacie JSON</p>
                                                    <button class="btn btn-primary" id="export-json">
                                                        <i class="fas fa-download"></i> Pobierz JSON
                                                    </button>
                                                </div>
                                                
                                                <div class="export-card">
                                                    <div class="export-icon">
                                                        <i class="fas fa-file-excel"></i>
                                                    </div>
                                                    <h4>Eksport Excel</h4>
                                                    <p>Dane uczestników w Excelu</p>
                                                    <button class="btn btn-success" id="export-excel">
                                                        <i class="fas fa-download"></i> Pobierz Excel
                                                    </button>
                                                </div>
                                                
                                                <div class="export-card">
                                                    <div class="export-icon">
                                                        <i class="fas fa-trash"></i>
                                                    </div>
                                                    <h4>Czyszczenie</h4>
                                                    <p>Usuń wszystkie dane</p>
                                                    <button class="btn btn-danger" id="clear-data">
                                                        <i class="fas fa-trash-alt"></i> Wyczyść dane
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <div class="export-info">
                                                <p><i class="fas fa-info-circle"></i> Dane są automatycznie zapisywane w przeglądarce</p>
                                                <p><i class="fas fa-database"></i> Rozmiar danych: ${Math.round((JSON.stringify(participants).length + JSON.stringify(eventData).length) / 1024)} KB</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="admin-footer">
                                <p><i class="fas fa-code"></i> Speed Dating Pro v${CONFIG.VERSION} | Panel administratora</p>
                            </div>
                        </div>
                    </div>
                `;

                this.setupAdminPanelListeners();
            }

            setupAdminPanelListeners() {
                // Przyciski nawigacji
                document.getElementById('refresh-admin')?.addEventListener('click', () => {
                    this.updateAdminPanel();
                });

                document.getElementById('back-to-mode-admin')?.addEventListener('click', () => {
                    this.showModeSelection();
                });

                // Przyciski sterowania
                document.getElementById('start-event-btn')?.addEventListener('click', () => {
                    this.startEvent();
                });

                document.getElementById('next-round-btn')?.addEventListener('click', () => {
                    this.nextRound();
                });

                document.getElementById('end-event-btn')?.addEventListener('click', () => {
                    this.endEvent();
                });

                document.getElementById('generate-pairs-btn')?.addEventListener('click', () => {
                    this.generateSmartPairings();
                    this.updateAdminPanel();
                });

                // Zapisywanie czasu
                document.getElementById('save-time-btn')?.addEventListener('click', () => {
                    this.saveTimeSettings();
                });

                // Przyciski eksportu
                document.getElementById('export-json')?.addEventListener('click', () => {
                    this.exportData('json');
                });

                document.getElementById('export-excel')?.addEventListener('click', () => {
                    this.exportData('excel');
                });

                document.getElementById('clear-data')?.addEventListener('click', () => {
                    this.clearAllData();
                });

                // Generuj pary z pustego ekranu
                document.getElementById('generate-pairs-now')?.addEventListener('click', () => {
                    this.generateSmartPairings();
                    this.updateAdminPanel();
                });

                // Odśwież pary
                document.getElementById('refresh-pairings')?.addEventListener('click', () => {
                    this.updateAdminPanel();
                });

                // Zakładki
                document.querySelectorAll('.tab-btn').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabId = tab.dataset.tab;
                        this.switchAdminTab(tabId);
                    });
                });
            }

            updateAdminPanel() {
                this.renderAdminPanel();
            }

            switchAdminTab(tabId) {
                document.querySelectorAll('.tab-btn').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.tab === tabId) {
                        tab.classList.add('active');
                    }
                });

                document.querySelectorAll('.tab-pane').forEach(pane => {
                    pane.classList.remove('active');
                });

                const targetTab = document.getElementById(`${tabId}-tab`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            }

            // ========== ZARZĄDZANIE WYDARZENIEM ==========
            startEvent() {
                const activeParticipants = participants.filter(p => p && p.active !== false);
                
                if (activeParticipants.length < CONFIG.MIN_PARTICIPANTS) {
                    this.showNotification(`Potrzeba co najmniej ${CONFIG.MIN_PARTICIPANTS} uczestników!`, 'error');
                    return;
                }
                
                if (confirm(`Rozpocząć wydarzenie z ${activeParticipants.length} uczestnikami?`)) {
                    this.generateSmartPairings();
                    
                    eventData.status = 'active';
                    eventData.currentRound = 1;
                    eventData.startedAt = new Date().toISOString();
                    
                    this.saveData();
                    this.startMainTimer();
                    
                    this.showNotification(`Wydarzenie rozpoczęte! ${activeParticipants.length} uczestników.`, 'success');
                    this.updateAdminPanel();
                }
            }

            nextRound() {
                if (eventData.currentRound >= eventData.totalRounds) {
                    this.showNotification('To już ostatnia runda!', 'warning');
                    return;
                }
                
                eventData.currentRound++;
                this.saveData();
                
                this.resetTimer();
                this.updateAdminPanel();
                
                this.showNotification(`Rozpoczynasz rundę ${eventData.currentRound}`, 'info');
            }

            endEvent() {
                if (confirm('Czy na pewno zakończyć wydarzenie?')) {
                    eventData.status = 'finished';
                    eventData.endedAt = new Date().toISOString();
                    
                    if (timerInterval) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                    }
                    
                    this.saveData();
                    this.updateAdminPanel();
                    
                    this.showNotification('Wydarzenie zakończone!', 'success');
                }
            }

            saveTimeSettings() {
                try {
                    const roundTimeInput = document.getElementById('round-time');
                    const ratingTimeInput = document.getElementById('rating-time');
                    const totalRoundsInput = document.getElementById('total-rounds');
                    
                    if (roundTimeInput) eventData.roundTime = parseInt(roundTimeInput.value) || 5;
                    if (ratingTimeInput) eventData.ratingTime = parseInt(ratingTimeInput.value) || 2;
                    if (totalRoundsInput) eventData.totalRounds = parseInt(totalRoundsInput.value) || 5;
                    
                    eventData.roundTime = Math.max(CONFIG.MIN_ROUND_TIME, Math.min(CONFIG.MAX_ROUND_TIME, eventData.roundTime));
                    eventData.totalRounds = Math.min(CONFIG.MAX_ROUNDS, eventData.totalRounds);
                    
                    this.saveData();
                    this.showNotification('Ustawienia czasu zapisane!', 'success');
                } catch (error) {
                    console.error('Błąd zapisywania ustawień:', error);
                    this.showNotification('Błąd zapisywania ustawień!', 'error');
                }
            }

            startMainTimer() {
                if (timerInterval) clearInterval(timerInterval);
                
                let timeLeft = (eventData.roundTime || 5) * 60;
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        this.showNotification('Czas rundy minął!', 'warning');
                    }
                }, 1000);
            }

            resetTimer() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                this.startMainTimer();
            }

            clearAllData() {
                if (confirm('CZY NA PEWNO CHCESZ USUNĄĆ WSZYSTKIE DANE?\n\nTo usunie wszystkich uczestników, oceny i dane wydarzenia. Tej operacji nie można cofnąć!')) {
                    localStorage.removeItem('speedDatingParticipants');
                    localStorage.removeItem('speedDatingEvent');
                    localStorage.removeItem('currentSessionId');
                    
                    participants = [];
                    eventData = this.getDefaultEventData();
                    currentUser = null;
                    
                    this.showNotification('Wszystkie dane zostały usunięte!', 'warning');
                    this.showModeSelection();
                }
            }

            // ========== ALGORYTM DOBIERANIA PAR ==========
            generateSmartPairings() {
                try {
                    const activeParticipants = participants.filter(p => p && p.active !== false);
                    
                    if (activeParticipants.length < 2) {
                        this.showNotification('Potrzeba co najmniej 2 uczestników!', 'error');
                        return [];
                    }

                    const pairings = [];
                    const usedPairs = new Set();
                    
                    for (let round = 1; round <= eventData.totalRounds; round++) {
                        const roundPairings = {
                            round: round,
                            pairs: [],
                            breakTable: []
                        };

                        const shuffled = [...activeParticipants].sort(() => Math.random() - 0.5);
                        const pairedIds = new Set();

                        for (let i = 0; i < shuffled.length; i++) {
                            if (pairedIds.has(shuffled[i].id)) continue;

                            let foundPartner = false;
                            for (let j = i + 1; j < shuffled.length; j++) {
                                if (pairedIds.has(shuffled[j].id)) continue;

                                const pairKey = [shuffled[i].id, shuffled[j].id].sort().join('_');
                                if (usedPairs.has(pairKey) && !eventData.settings?.allowRepeats) {
                                    continue;
                                }

                                roundPairings.pairs.push([shuffled[i], shuffled[j]]);
                                pairedIds.add(shuffled[i].id);
                                pairedIds.add(shuffled[j].id);
                                usedPairs.add(pairKey);
                                foundPartner = true;
                                break;
                            }

                            if (!foundPartner && i < shuffled.length - 1) {
                                for (let j = 0; j < i; j++) {
                                    if (!pairedIds.has(shuffled[j].id)) {
                                        const pairKey = [shuffled[i].id, shuffled[j].id].sort().join('_');
                                        if (usedPairs.has(pairKey) && !eventData.settings?.allowRepeats) {
                                            continue;
                                        }
                                        
                                        roundPairings.pairs.push([shuffled[i], shuffled[j]]);
                                        pairedIds.add(shuffled[i].id);
                                        pairedIds.add(shuffled[j].id);
                                        usedPairs.add(pairKey);
                                        break;
                                    }
                                }
                            }
                        }

                        shuffled.forEach(p => {
                            if (!pairedIds.has(p.id)) {
                                roundPairings.breakTable.push(p);
                            }
                        });

                        pairings.push(roundPairings);
                    }

                    eventData.pairings = pairings;
                    this.saveData();
                    
                    this.showNotification(`Wygenerowano pary dla ${eventData.totalRounds} rund`, 'success');
                    return pairings;

                } catch (error) {
                    console.error('Błąd generowania par:', error);
                    this.showNotification('Błąd generowania par!', 'error');
                    return [];
                }
            }

            // ========== SYSTEM OCENIANIA ==========
            showRatingScreen(partner) {
                this.hideAllScreens();
                currentPartner = partner;
                
                const ratingScreen = document.getElementById('rating-screen');
                if (ratingScreen) ratingScreen.classList.add('active');
                
                const ratePerson = document.getElementById('rate-person');
                if (ratePerson) ratePerson.textContent = partner.username;
                
                this.initializeRatingScreen();
            }

            initializeRatingScreen() {
                let selectedRating = null;
                
                document.querySelectorAll('.rate-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.rate-btn').forEach(b => b.classList.remove('selected'));
                        btn.classList.add('selected');
                        selectedRating = btn.dataset.rating;
                    });
                });
                
                const submitBtn = document.getElementById('submit-rating');
                if (submitBtn) {
                    submitBtn.addEventListener('click', () => {
                        this.submitRating(selectedRating);
                    });
                }
            }

            submitRating(rating) {
                if (!rating || !currentPartner || !currentUser) {
                    this.showNotification('Wybierz ocenę!', 'error');
                    return;
                }

                const note = document.getElementById('rating-note')?.value || '';
                
                if (!currentUser.ratings) currentUser.ratings = {};
                currentUser.ratings[currentPartner.id] = {
                    rating: rating,
                    note: note,
                    round: eventData.currentRound || 1,
                    timestamp: new Date().toISOString()
                };

                if (!eventData.ratings) eventData.ratings = [];
                eventData.ratings.push({
                    from: currentUser.id,
                    to: currentPartner.id,
                    rating: rating,
                    round: eventData.currentRound || 1,
                    timestamp: new Date().toISOString()
                });

                const userIndex = participants.findIndex(p => p && p.id === currentUser.id);
                if (userIndex !== -1) {
                    participants[userIndex] = currentUser;
                }

                this.saveData();
                
                this.showNotification('Ocena zapisana! Dziękujemy!', 'success');
                setTimeout(() => {
                    this.showUserPanel();
                }, 1000);
            }

            // ========== EKSPORT DANYCH ==========
            exportData(format) {
                try {
                    const exportData = {
                        event: eventData,
                        participants: participants.filter(p => p && p.active !== false),
                        timestamp: new Date().toISOString(),
                        version: CONFIG.VERSION
                    };
                    
                    const filename = `speed-dating-${new Date().toISOString().slice(0,10)}-${Date.now()}`;
                    
                    switch(format) {
                        case 'json':
                            this.exportJSON(exportData, filename);
                            break;
                        case 'excel':
                            this.exportExcel(exportData, filename);
                            break;
                    }
                    
                } catch (error) {
                    console.error('Błąd eksportu:', error);
                    this.showNotification('Błąd eksportu danych!', 'error');
                }
            }

            exportJSON(data, filename) {
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', `${filename}.json`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Dane wyeksportowane jako JSON!', 'success');
            }

            exportExcel(data, filename) {
                try {
                    const participantsData = data.participants.map(p => ({
                        'ID': p.id,
                        'Nazwa użytkownika': p.username,
                        'Email': p.email,
                        'Płeć': p.gender === 'male' ? 'Mężczyzna' : p.gender === 'female' ? 'Kobieta' : 'Inna',
                        'Wiek': p.age || 'Nie podano',
                        'Szuka': p.interested?.map(i => 
                            i === 'male' ? 'Mężczyzn' : i === 'female' ? 'Kobiet' : 'Innych'
                        ).join(', ') || 'Nie określono',
                        'Data dołączenia': new Date(p.joinedAt).toLocaleString(),
                        'Status': p.active ? 'Aktywny' : 'Nieaktywny'
                    }));
                    
                    const wb = XLSX.utils.book_new();
                    const wsParticipants = XLSX.utils.json_to_sheet(participantsData);
                    XLSX.utils.book_append_sheet(wb, wsParticipants, 'Uczestnicy');
                    
                    XLSX.writeFile(wb, `${filename}.xlsx`);
                    
                    this.showNotification('Dane wyeksportowane jako Excel!', 'success');
                    
                } catch (error) {
                    console.error('Błąd eksportu Excel:', error);
                    this.showNotification('Błąd eksportu do Excel!', 'error');
                }
            }

            // ========== SYSTEM POWIADOMIEŃ ==========
            showNotification(message, type = 'info') {
                if (typeof toastr !== 'undefined') {
                    switch(type) {
                        case 'success':
                            toastr.success(message);
                            break;
                        case 'error':
                            toastr.error(message);
                            break;
                        case 'warning':
                            toastr.warning(message);
                            break;
                        default:
                            toastr.info(message);
                            break;
                    }
                } else {
                    alert(`${type.toUpperCase()}: ${message}`);
                }
            }

            // ========== SYSTEM POŁĄCZENIA ==========
            startHeartbeat() {
                setInterval(() => {
                    if (currentUser) {
                        this.updateUserLastSeen();
                    }
                }, CONFIG.HEARTBEAT_INTERVAL);
            }

            updateUserLastSeen() {
                if (currentUser) {
                    currentUser.lastSeen = new Date().toISOString();
                    
                    const userIndex = participants.findIndex(p => p && p.id === currentUser.id);
                    if (userIndex !== -1) {
                        participants[userIndex] = currentUser;
                        this.saveData();
                    }
                }
            }

            // ========== UTILITIES ==========
            formatTime(seconds) {
                const min = Math.floor(seconds / 60);
                const sec = seconds % 60;
                return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
            }

            handleLogout() {
                if (confirm('Czy na pewno chcesz się wylogować?')) {
                    if (currentUser) {
                        const userIndex = participants.findIndex(p => p && p.id === currentUser.id);
                        if (userIndex !== -1) {
                            participants[userIndex].active = false;
                            participants[userIndex].loggedOutAt = new Date().toISOString();
                            this.saveData();
                        }
                    }
                    
                    currentUser = null;
                    localStorage.removeItem('currentSessionId');
                    
                    this.showNotification('Wylogowano pomyślnie', 'success');
                    this.showModeSelection();
                }
            }

            setupEventListeners() {
                // Obsługa wyboru trybu
                document.querySelectorAll('.mode-select-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const mode = btn.dataset.mode;
                        this.handleModeSelection(mode);
                    });
                });
            }

            handleModeSelection(mode) {
                switch(mode) {
                    case 'participant':
                        this.showRegistrationScreen();
                        break;
                    case 'admin':
                        this.showAdminPanel();
                        break;
                    case 'demo':
                        this.startDemoMode();
                        break;
                }
            }

            startDemoMode() {
                isDemoMode = true;
                
                currentUser = {
                    id: 'demo_user_' + Date.now(),
                    username: 'DemoUżytkownik',
                    email: 'demo@example.com',
                    gender: 'male',
                    interested: ['female'],
                    age: 30,
                    bio: 'To jest konto demo do testowania aplikacji',
                    joinedAt: new Date().toISOString(),
                    ratings: {},
                    tags: {},
                    status: 'active',
                    active: true,
                    lastSeen: new Date().toISOString(),
                    sessionId: 'demo_session_' + Date.now(),
                    avatarColor: '#667eea'
                };
                
                eventData = {
                    status: 'active',
                    currentRound: 1,
                    totalRounds: 5,
                    roundTime: 3,
                    ratingTime: 1,
                    pairings: [],
                    ratings: [],
                    settings: {
                        allowRepeats: true,
                        maxParticipants: 10,
                        matchingAlgorithm: 'smart',
                        notifications: true
                    },
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                this.addDemoUsers();
                
                this.showNotification('Tryb demo aktywowany!', 'success');
                this.showUserPanel();
            }

            addDemoUsers() {
                const demoUsers = [
                    {
                        username: 'JanKowalski',
                        email: 'jan@example.com',
                        gender: 'male',
                        interested: ['female'],
                        age: 28,
                        bio: 'Lubię podróże i dobrą książkę',
                        avatarColor: '#667eea'
                    },
                    {
                        username: 'AnnaNowak',
                        email: 'anna@example.com',
                        gender: 'female',
                        interested: ['male'],
                        age: 26,
                        bio: 'Fotograf amator, miłośniczka kina',
                        avatarColor: '#f56565'
                    },
                    {
                        username: 'PiotrWiśniewski',
                        email: 'piotr@example.com',
                        gender: 'male',
                        interested: ['female'],
                        age: 32,
                        bio: 'Programista, fan górskich wędrówek',
                        avatarColor: '#48bb78'
                    },
                    {
                        username: 'MagdalenaLewandowska',
                        email: 'magda@example.com',
                        gender: 'female',
                        interested: ['male'],
                        age: 29,
                        bio: 'Lekarka, uwielbiam taniec i podróże',
                        avatarColor: '#ed8936'
                    }
                ];

                demoUsers.forEach(demoUser => {
                    const existing = participants.find(p => p && p.email === demoUser.email);
                    
                    if (!existing) {
                        const newUser = {
                            ...demoUser,
                            id: 'demo_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                            joinedAt: new Date().toISOString(),
                            ratings: {},
                            tags: {},
                            status: 'active',
                            active: true,
                            lastSeen: new Date().toISOString(),
                            sessionId: 'demo_session_' + Math.random().toString(36).substr(2, 9)
                        };
                        
                        participants.push(newUser);
                    }
                });
                
                this.saveData();
            }
        }

        // ========== INICJALIZACJA APLIKACJI ==========
        let app;

        // Start aplikacji kiedy DOM jest gotowy
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                app = new SpeedDatingApp();
            });
        } else {
            app = new SpeedDatingApp();
        }

        // Eksport do globalnego scope
        window.app = app;
        window.formatTime = (seconds) => {
            const min = Math.floor(seconds / 60);
            const sec = seconds % 60;
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        };

        // Animacja spinnera
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
